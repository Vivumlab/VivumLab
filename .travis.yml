# travis.yml
language: python
python: 3.8

stages:
  - pre-commit
  - master
  - deploy docs

jobs:
  include:
    - stage: master
      name: "Master commitlint"
      if: branch = master
      install:
        - npm install --save-dev @commitlint/cli @commitlint/config-conventional @commitlint/travis-cli
      script:
        - commitlint-travis
    - stage: pre-commit
      script: pre-commit run --all-files
      name: "Pre-commit run"
      install:
        - pip3 install pre-commit
    - stage: deploy docs
      install:
        - pip3 install mkdocs
        - pip3 install mkdocs-material
        - pip3 install mkdocs-git-revision-date-localized-plugin
      script: mkdocs build --verbose --clean --strict
      name: "Deploy MKDocs to GH-Pages"
      deploy:
        fqdn: docs.vivumlab.com
        provider: pages
        skip_cleanup: true
        github_token: $GITHUB_TOKEN # Set in travis-ci.org dashboard
        local_dir: site
        on:
          branch: master

cache:
  directories:
    - $HOME/.cache/pre-commit
