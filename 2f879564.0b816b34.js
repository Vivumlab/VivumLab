(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{232:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return p}));var a=n(0),o=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=o.a.createContext({}),b=function(e){var t=o.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=b(e.components);return o.a.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},m=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=b(n),m=a,p=u["".concat(i,".").concat(m)]||u[m]||d[m]||r;return n?o.a.createElement(p,s(s({ref:t},c),{},{components:n})):o.a.createElement(p,s({ref:t},c))}));function p(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var c=2;c<r;c++)i[c]=n[c];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},97:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return s})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return b}));var a=n(3),o=n(7),r=(n(0),n(232)),i={id:"storage",title:"How VivumLab uses Storage",hide_title:!0,hide_table_of_contents:!1,sidebar_label:"Storage",custom_edit_url:"https://github.com/VivumLab/VivumLab/issues/new?template=documentation.md"},s={unversionedId:"core/storage",id:"core/storage",isDocsHomePage:!1,title:"How VivumLab uses Storage",description:"How VivumLab uses Storage",source:"@site/docs/core/Storage.md",slug:"/core/storage",permalink:"/docs/core/storage",editUrl:"https://github.com/VivumLab/VivumLab/issues/new?template=documentation.md",version:"current",sidebar_label:"Storage",sidebar:"docs",previous:{title:"Vivumlab Commands",permalink:"/docs/core/commands"},next:{title:"Terraform",permalink:"/docs/core/terraform"}},l=[{value:"Understanding storage types and their uses",id:"understanding-storage-types-and-their-uses",children:[]},{value:"Understanding Collection Auto-Volumes",id:"understanding-collection-auto-volumes",children:[]},{value:"Understanding the <code>storage_dir</code> config variable",id:"understanding-the-storage_dir-config-variable",children:[{value:"Migrating storage",id:"migrating-storage",children:[]}]},{value:"Understanding NAS configuration for VivumLab",id:"understanding-nas-configuration-for-vivumlab",children:[]},{value:"NAS Configuration",id:"nas-configuration",children:[]}],c={rightToc:l};function b(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("h1",{id:"how-vivumlab-uses-storage"},"How VivumLab uses Storage"),Object(r.b)("h2",{id:"understanding-storage-types-and-their-uses"},"Understanding storage types and their uses"),Object(r.b)("p",null,"There are 3 kinds of storage related to Docker and Docker compose. And by extension, VivumLab."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Ephemeral - This storage disappears when the container is shut down. It's used for things like temporary storage for a containers services.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Volume - These are mounted by the container and 'map' a physical (host, ubuntu) directory, to a containers internal directory. Volumes are used for persistent storage. For instance, Mysql's DB storage directories are mapped to host folders so that even if the container restarts, the db's storage exists when it restarts. You'll see these referenced in docker-compose.yml files like this:"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yml"}),"volumes:\n  - /var/vivumlab/serviceName:/MyFiles\n")),Object(r.b)("p",{parentName:"li"},"This mapping of a volume means that the container, and it's software can access the contents of ",Object(r.b)("inlineCode",{parentName:"p"},"/var/vivumlab/serviceName")," by accessing it's own ",Object(r.b)("inlineCode",{parentName:"p"},"/MyFiles")," directory.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"NAS - Network Attached Storage volume(s) - NAS Volumes - are volumes, but they're controlled, in part, by VivumLab. If you enable NAS storage in your config, and provide valid credentials to your NAS, VivumLab will take care of mounting your NAS for you."))),Object(r.b)("h2",{id:"understanding-collection-auto-volumes"},"Understanding Collection Auto-Volumes"),Object(r.b)("p",null,"VivumLab provides a number of services designed to act on, or share, collections of data. For instance, Airsonic is designed to provide you a web interface to your music collection. But Airsonic isn't alone. Jellyfin, Plex and Funkwhale all provide that same access to your music collection. To enable these services to share access to a common collection of media (or documents, etc.) VivumLab creates, and maintains a series of collection folders that are auto-mapped by docker when the service is brought online. VivumLab uses the following Collection Auto-volumes"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Backups"),Object(r.b)("li",{parentName:"ul"},"Books"),Object(r.b)("li",{parentName:"ul"},"Documents"),Object(r.b)("li",{parentName:"ul"},"Downloads"),Object(r.b)("li",{parentName:"ul"},"Music"),Object(r.b)("li",{parentName:"ul"},"Pictures"),Object(r.b)("li",{parentName:"ul"},"temp"),Object(r.b)("li",{parentName:"ul"},"Video")),Object(r.b)("p",null,"In general, if it makes sense for a VivumLab service to have access to a given collection, you'll find that it's automatically set up for you. For instance, out of the box, Airsonic has access to the Music volume, and Nextcloud has access to the Documents volume."),Object(r.b)("p",null,"These folders are maintained by VivumLab inside the directory specified by the ",Object(r.b)("inlineCode",{parentName:"p"},"storage_dir")," configuration variable."),Object(r.b)("h2",{id:"understanding-the-storage_dir-config-variable"},"Understanding the ",Object(r.b)("inlineCode",{parentName:"h2"},"storage_dir")," config variable"),Object(r.b)("p",null,"Your settings/config.yml file contains a variable named ",Object(r.b)("inlineCode",{parentName:"p"},"storage_dir")," that defaults to the directory ",Object(r.b)("inlineCode",{parentName:"p"},"/mnt/nas"),"."),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"Despite the name, this folder ",Object(r.b)("em",{parentName:"p"},"does not have to be a NAS Mount"),".")),Object(r.b)("p",null,"If you're not using a NAS, because you've got an external hard drive attached, or an internal raid array you've already mounted that's fine. Just set the ",Object(r.b)("inlineCode",{parentName:"p"},"storage_dir")," config variable to the directory where you have mounted your storage."),Object(r.b)("p",null,"Whenever you enable a service, VivumLab verifies that the storage_dir contains directories that match the collection auto-volumes mentioned above."),Object(r.b)("p",null,"Setting up and mounting storage is a complex and potentially destructive task. As such, it is outside the scope of VivumLab to do this; this is the intention of the developers.\n!!! Please research, and be careful."),Object(r.b)("h3",{id:"migrating-storage"},"Migrating storage"),Object(r.b)("p",null,"At some point, you may need to change where your ",Object(r.b)("inlineCode",{parentName:"p"},"storage_dir")," points, either because you've run out of space, or moved to a NAS. The following are high-level instructions on ",Object(r.b)("em",{parentName:"p"},"what")," you need to do to migrate your data from one storage asset to another."),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Run ",Object(r.b)("inlineCode",{parentName:"li"},"systemctl stop docker")," ",Object(r.b)("em",{parentName:"li"},"on your VivumLab server")," to disable all VivumLab services that might try to read or write to your existing storage directory"),Object(r.b)("li",{parentName:"ol"},"Mount your new storage somewhere other than ",Object(r.b)("inlineCode",{parentName:"li"},"/mnt/nas"),".. eg. ",Object(r.b)("inlineCode",{parentName:"li"},"/media/newHd")),Object(r.b)("li",{parentName:"ol"},"Copy or Move the contents of your ",Object(r.b)("inlineCode",{parentName:"li"},"/mnt/nas")," directory to the newly mounted directory."),Object(r.b)("li",{parentName:"ol"},"Edit your. ",Object(r.b)("inlineCode",{parentName:"li"},"settings/config.yml")," and change ",Object(r.b)("inlineCode",{parentName:"li"},"storage_dir")," to point at the newly mounted directory."),Object(r.b)("li",{parentName:"ol"},"Run ",Object(r.b)("inlineCode",{parentName:"li"},"systemctl start docker")," ",Object(r.b)("em",{parentName:"li"},"on your VivumLab server")," to reenable docker"),Object(r.b)("li",{parentName:"ol"},"Run ",Object(r.b)("inlineCode",{parentName:"li"},"vlab update")," to re-deploy VivumLab with the new storage_dir set.")),Object(r.b)("h2",{id:"understanding-nas-configuration-for-vivumlab"},"Understanding NAS configuration for VivumLab"),Object(r.b)("p",null,"Different VivumLab services operate on libraries of media (Airsonic, Plex, and Piwigo as examples). Since these libraries can be large, it makes sense to keep them on another machine with lots of storage."),Object(r.b)("p",null,"NAS shares are mounted on the Vivumlab host under ",Object(r.b)("inlineCode",{parentName:"p"},"/mnt/nas"),", which defaults to ",Object(r.b)("inlineCode",{parentName:"p"},"/mnt/nas"),". By default, NAS is disabled, and the services that can use it will instead use local folders under ",Object(r.b)("inlineCode",{parentName:"p"},"/mnt/nas"),".\nFor example, Emby will map ",Object(r.b)("inlineCode",{parentName:"p"},"/mnt/nas/Video/TV")," and ",Object(r.b)("inlineCode",{parentName:"p"},"/mnt/nas/Video/Movies")," into its container, and Paperless will mount ",Object(r.b)("inlineCode",{parentName:"p"},"/mnt/nas/Documents"),". Check the ",Object(r.b)("inlineCode",{parentName:"p"},"docker-compose")," files for each service to see what directories are used."),Object(r.b)("p",null,"VivumLab has a NAS section in the ",Object(r.b)("inlineCode",{parentName:"p"},"settings/config.yml")," file. This allows you to specify the connection details and credentials to access your NAS. These details are used ",Object(r.b)("em",{parentName:"p"},"in conjunction with the ",Object(r.b)("inlineCode",{parentName:"em"},"storage_dir")," variable")," to create and maintain ",Object(r.b)("inlineCode",{parentName:"p"},"/etc/fstab")," entries."),Object(r.b)("p",null,"!!! NOTE: VivumLab is configured to write ",Object(r.b)("inlineCode",{parentName:"p"},"/etc/fstab")," entries that mount your NAS folders within, ",Object(r.b)("em",{parentName:"p"},"or on top of")," the ",Object(r.b)("inlineCode",{parentName:"p"},"storage_dir")," directory** Be careful not to mount your NAS folders ",Object(r.b)("em",{parentName:"p"},"over")," existing files in your ",Object(r.b)("inlineCode",{parentName:"p"},"storage_dir")," or everyone will be very confused."),Object(r.b)("h2",{id:"nas-configuration"},"NAS Configuration"),Object(r.b)("p",null,"To configure your NAS, edit the ",Object(r.b)("inlineCode",{parentName:"p"},"# NAS Config")," section of ",Object(r.b)("inlineCode",{parentName:"p"},"settings/config.yml"),"."),Object(r.b)("p",null,"Your NAS options are:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"nas_enable")," to ",Object(r.b)("inlineCode",{parentName:"li"},"True")," VivumLab will start maintaining the mounting of your NAS for you, if set to ",Object(r.b)("inlineCode",{parentName:"li"},"True"),", and after you run ",Object(r.b)("strong",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"strong"},"vlab update"))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"nas_host"),": this is the IP or hostname of your NAS server/device. ie: 192.168.1.130"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"nas_mount_type"),": your options here are ",Object(r.b)("inlineCode",{parentName:"li"},"nfs"),", ",Object(r.b)("inlineCode",{parentName:"li"},"cifs"),", or ",Object(r.b)("inlineCode",{parentName:"li"},"smb"),". While Ubuntu can mount just about anything, VivumLab only knows how to maintain those three connection types."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"nas_share_path"),": this represents the path to the shared directory on your NAS."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"nas_user"),": username to authenticate with. ","*","defaults to the value of ",Object(r.b)("inlineCode",{parentName:"li"},"default_username")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"nas_pass"),": password to authenticate with."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"nas_workgroup"),": Workgroup needed for some SMB/CIFS shares.")),Object(r.b)("p",null,"run ",Object(r.b)("strong",{parentName:"p"},Object(r.b)("inlineCode",{parentName:"strong"},"vlab deploy"))," when complete, to enable the updated NAS configuration."),Object(r.b)("p",null,'??? example "Example ',Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://unraid.net"}),"unRAID"),' configuration"'),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"```\nnas_enable: True\nnas_host: unraid.mydomain.com\nnas_mount_type: nfs\nnas_share_path: /mnt/user\nnas_user:\nnas_pass:\nnas_workgroup:\n```\n")),Object(r.b)("p",null,'??? example "Example SMB configuration"'),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"```\nnas_enable: True\nnas_host: 192.168.1.12\nnas_mount_type: smb\nnas_share_path: vivumlab\nnas_user: user\nnas_pass: 12345\nnas_workgroup: WORKGROUP\n```\n")))}b.isMDXComponent=!0}}]);