#jinja2: trim_blocks:False
##############################
# General/ Pixelfed specific #
##############################

## Crypto
APP_KEY={{ lookup('password', './settings/passwords/pixelfed_app_key chars=ascii_letters length=32') }}

## General Settings
APP_NAME="Pixelfed"
APP_ENV=production
APP_DEBUG=false
APP_URL=https://{% if pixelfed.domain %}{{ pixelfed.domain }}{% else %}{{ pixelfed.subdomain + "." + domain }}{% endif %}
APP_DOMAIN="{% if pixelfed.domain %}{{ pixelfed.domain }}{% else %}{{ pixelfed.subdomain + "." + domain }}{% endif %}"
ADMIN_DOMAIN="{% if pixelfed.domain %}{{ pixelfed.domain }}{% else %}{{ pixelfed.subdomain + "." + domain }}{% endif %}"
SESSION_DOMAIN="{% if pixelfed.domain %}{{ pixelfed.domain }}{% else %}{{ pixelfed.subdomain + "." + domain }}{% endif %}"

OPEN_REGISTRATION=true
ENFORCE_EMAIL_VERIFICATION=true
PF_MAX_USERS=1000
OAUTH_ENABLED=true

APP_TIMEZONE={{ common_timezone }}
APP_LOCALE=en

## Pixelfed Tweaks
LIMIT_ACCOUNT_SIZE=true
MAX_ACCOUNT_SIZE=1000000
MAX_PHOTO_SIZE=15000
MAX_AVATAR_SIZE=2000
MAX_CAPTION_LENGTH=350
MAX_BIO_LENGTH=125
MAX_NAME_LENGTH=30
MAX_ALBUM_LENGTH=4
IMAGE_QUALITY=80
PF_OPTIMIZE_IMAGES=true
PF_OPTIMIZE_VIDEOS=true
ADMIN_ENV_EDITOR=true
ACCOUNT_DELETION=true
ACCOUNT_DELETE_AFTER=false
MAX_LINKS_PER_POST=0

## Instance
#INSTANCE_DESCRIPTION=
INSTANCE_PUBLIC_HASHTAGS=false
#INSTANCE_CONTACT_EMAIL=
INSTANCE_PUBLIC_LOCAL_TIMELINE=false
#BANNED_USERNAMES=
STORIES_ENABLED=false
RESTRICTED_INSTANCE=false

#################################################
# Mail (See pixelfed docs for more information) #
#################################################

MAIL_DRIVER=smtp
MAIL_HOST={{ vault.smtp.host }}
MAIL_PORT={{ vault.smtp.port }}
MAIL_FROM_ADDRESS={{ vault.smtp.from_email }}
MAIL_FROM_NAME={{ vault.smtp.from_name }}
MAIL_USERNAME={{ vault.smtp.user }}
MAIL_PASSWORD={{ vault.smtp.pass }}
MAIL_ENCRYPTION=tls

###################################
# Databases (MariaDB by default) #
###################################

## Databases (MariaDB)
DB_CONNECTION=mysql
DB_HOST=db
DB_PORT=3306
DB_DATABASE=pixelfed
DB_USERNAME=pixelfed
DB_PASSWORD={{ lookup('password', './settings/passwords/pixelfed_db_password chars=ascii_letters length=15') }}

## Databases (Postgres)
#DB_CONNECTION=pgsql
#DB_HOST=postgres
#DB_PORT=5432
#DB_DATABASE=pixelfed
#DB_USERNAME=pixelfed
#DB_PASSWORD={{ lookup('password', './settings/passwords/pixelfed_db_password chars=ascii_letters length=15') }}

############################
# Cache (Redis by default) #
############################

## Cache (Redis)
REDIS_CLIENT=phpredis
REDIS_SCHEME=tcp
REDIS_HOST=redis
REDIS_PASSWORD={{ lookup('password', './settings/passwords/pixelfed_redis_password chars=ascii_letters length=15') }}
REDIS_PORT=6379
REDIS_DATABASE=0


###################################################
# Do not touch, unless you know what you're doing #
###################################################

## EXPERIMENTS
EXP_LC=false
EXP_REC=false
EXP_LOOPS=false

## ActivityPub Federation (Federates by default)
ACTIVITY_PUB=true
AP_REMOTE_FOLLOW=true
AP_SHAREDINBOX=true
AP_INBOX=true
AP_OUTBOX=true
ATOM_FEEDS=true
NODEINFO=true
WEBFINGER=true

## Might need to run this to federate (TBD)
#   php artisan cache:clear
#   php artisan optimize:clear
#   php artisan optimize

## S3
FILESYSTEM_DRIVER=local
FILESYSTEM_CLOUD=s3
PF_ENABLE_CLOUD=false
#AWS_ACCESS_KEY_ID=
#AWS_SECRET_ACCESS_KEY=
#AWS_DEFAULT_REGION=
#AWS_BUCKET=
#AWS_URL=
#AWS_ENDPOINT=
#AWS_USE_PATH_STYLE_ENDPOINT=false

## Horizon
HORIZON_DARKMODE=false  # Horizon theme darkmode
HORIZON_EMBED=false  # Single Docker Container mode

## COSTAR - Confirm Object Sentiment Transform and Reduce
PF_COSTAR_ENABLED=false

# Media
MEDIA_EXIF_DATABASE=false

## Logging
LOG_CHANNEL=stack

## Image
IMAGE_DRIVER=imagick

## Broadcasting
BROADCAST_DRIVER=log  # log driver for local development

## Cache
CACHE_DRIVER=redis

## Purify
RESTRICT_HTML_TYPES=true

## Queue
QUEUE_DRIVER=redis

## Session
SESSION_DRIVER=redis

## Trusted Proxy
TRUST_PROXIES="*"

## Passport
#PASSPORT_PRIVATE_KEY=
#PASSPORT_PUBLIC_KEY=
